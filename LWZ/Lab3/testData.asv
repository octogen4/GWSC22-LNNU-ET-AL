data = load('testData.txt');

figure;
plot(data(:,1),data(:,2));

timeVec = data(:,1);
dataVec = data(:,2);

% get sinal-free part
id = find(timeVec>=5.0,1)-1;
sigfreeTime=timeVec(1:id);
sigfreeData=dataVec(1:id);
figure;
plot(sigfreeTime,sigfreeData);

% find the noise PSD
samplFreq = id/timeVec(id);
[noisePSD,sigfreeFreq]=pwelch(sigfreeData', 256,[],[],samplFreq);
figure;
plot(sigfreeFreq,noisePSD);

% Whiten the data
sqrtPSD = sqrt(noisePSD);
fltrOrdr = 50;
b = fir2(fltrOrdr,sigfreeFreq/(sampFreq/2),sqrtPSD);

inNoise = randn(1,length(timeVec)); % input a WGN
outNoise = sqrt(sampFreq)*fftfilt(b,inNoise);

